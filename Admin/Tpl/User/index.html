<include file="Public:header" />
<!-- 添加用户模态框（Modal） -->
<div class="modal fade" id="add_user" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content animated flipInX">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
				<h4 class="modal-title">添加用户</h4>
			</div>
			<div class="modal-body">
				<div>
					<form class="form-horizontal" id="add_u">
						<div class="form-group">
							<label class="col-lg-3 control-label">教师姓名：</label>

							<div class="col-lg-8">
								<input type="text" class="form-control" name="uname" form="add_u">
							</div>
						</div>
						<div class="form-group">
							<label class="col-lg-3 control-label">所属院系：</label>

							<div class="col-lg-8">
								<input list="xuanxi" class="form-control" name="yx" form="add_u">
								<datalist id="xuanxi">
                                    <option>计算机学院</option>
                                    <option>软件学院</option>
                                </datalist>
							</div>
						</div>
						<div class="form-group">
							<label class="col-lg-3 control-label">职称：</label>

							<div class="col-lg-8">
								<input list="zhicheng" class="form-control" name="zc" form="add_u">
								<datalist id="zhicheng">
                                    <option>教师</option>
                                    <option>讲师</option>
                                    <option>教研室主任</option>
                                    <option>教研室副主任</option>
                                    <option>教授</option>
                                    <option>副教授</option>
                                </datalist>
							</div>
						</div>
						<div class="form-group">
							<label class="col-lg-3 control-label">学历：</label>

							<div class="col-lg-8">
								<input list="xueli" class="form-control" name="xl" form="add_u">
								<datalist id="xueli">
                                    <option>博士</option>
                                    <option>硕士</option>
                                    <option>学士</option>
                                </datalist>
							</div>
						</div>
						<div class="form-group">
							<label class="col-lg-3 control-label">手机号：</label>

							<div class="col-lg-8">
								<input type="tel" class="form-control" name="phone" form="add_u">
							</div>
						</div>
					</form>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
				<button type="button" class="btn btn-primary" id="add">添加</button>
			</div>
		</div>
		<!-- /.modal-content -->
	</div>
	<!-- /.modal-dialog -->
</div>

<!--页面显示全部-->
<div id="wrapper">
	<include file="Public:left" />
	<!--右边显示部分-->
	<div id="page-wrapper" class="gray-bg dashbard-1">
		<include file="Public:top" />
		<!--用户管理-->
		<div id="user_control" class="right" style="display: block;">
			<div class="row wrapper border-bottom white-bg page-heading">
				<div class="col-lg-12">
					<h2>用户管理</h2>
					<ol class="breadcrumb">
						<li>
							<a href="index.html">主页</a>
						</li>
						<li>
							<a>用户管理</a>
							<li>
								<strong>用户管理</strong>
							</li>
					</ol>
				</div>
			</div>
			<div class="wrapper wrapper-content animated fadeInRight">
				<div class="row">
					<div class="col-lg-12">
						<div class="ibox float-e-margins">
							<div class="ibox-title">
								<h5>搜索结果</h5>

								<div class="ibox-tools">
									<a class="collapse-link">
										<i class="fa fa-chevron-up"></i>
									</a>
									<a class="dropdown-toggle" data-toggle="dropdown" href="table_data_tables.html#">
										<i class="fa fa-wrench"></i>
									</a>
									<ul class="dropdown-menu dropdown-user">
										<li>
											<a href="#">选项1</a>
										</li>
										<li>
											<a href="#">选项2</a>
										</li>
									</ul>
									<a class="close-link">
										<i class="fa fa-times"></i>
									</a>
								</div>
							</div>
							<div class="ibox-content">
								<div class="">
									<a onclick="deluser(this);" href="javascript:void(0);" class="btn btn-danger"><span class="glyphicon glyphicon-trash"></span> 批量删除用户</a>&nbsp;
									<a onclick="adduser(this);" href="javascript:void(0);" class="btn btn-success " data-toggle="modal" data-target="#add_user"><span class="glyphicon glyphicon-plus"></span> 添加用户</a>&nbsp;
									<!--<a onclick="pilian(this);" href="javascript:void(0);" class="btn btn-primary"><span class="glyphicon glyphicon-log-in"></span> 批量导入用户</a>-->
									<div class="pull-right">
										<form id="uploadForm_1" method="post" action="data/file_upload.php"
                                          enctype="multipart/form-data">
                                        <input type="text" id="txt" name="txt"
                                               style="height:24px; line-height:24px; border-right:none; width:200px;">
                                        <input type="button"
                                               onmousemove="f.style.pixelLeft=event.x-60;f.style.pixelTop=this.offsetTop;"
                                               value="批量上传用户" size="30" onclick="f.click()"
                                               style="width:100px;height:26px;background:url(/jscss/demoimg/201206/bgimg.jpg) no-repeat; cursor:pointer;">
                                        <input type="file" id="k" onchange="txt.value=this.value" name="f"
                                               style=" position:absolute; left:202px; top:52px; heigth:26px;cursor:pointer;filter: Alpha(opacity=0);-moz-opacity:0;opacity:0;"
                                               size="1" hidefocus>
                                        <!--<input type="file" name="file" id="file1" />-->
                                    </form>
                                    <br/>
                                    <a href="__PUBLIC__/Download/users.xlsx">上传模板下载</a>
                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                    <button id="upUsers" class="btn btn-primary" class="pull-left">上传</button>
									</div>
									</div>
									<br />
								<table id='user' class="table table-striped table-bordered table-hover dataTables-example">
									<thead>
										<tr>
											<th class="text-center"><input type="checkbox" data-check="check_user" />全选</th>
											<th class="text-center">教师姓名</th>
											<th class='text-center'>所属院系</th>
											<th class='text-center'>职称</th>
											<th class='text-center'>学历</th>
											<th class='text-center'>手机号</th>
											<th class='text-center'>操作</th>
										</tr>
									</thead>
									<tbody>

									</tbody>
									<tfoot>
										<tr>
											<th class="text-center">全选</th>
											<th class="text-center">教师姓名</th>
											<th class='text-center'>所属院系</th>
											<th class='text-center'>职称</th>
											<th class='text-center'>学历</th>
											<th class='text-center'>手机号</th>
											<th class='text-center'>操作</th>
										</tr>
									</tfoot>
								</table>

							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

	</div>
</div>
<include file="Public:bottom" />
<script src="__PUBLIC__/JS/upexel.js"></script>
<script>
	//删除用户
	function deluser(self) {
		var class_array = [];
		var th = [];
		$("input[class='check_user']").prop("checked", function(i, val) {
			if(val) {
				var data = $(this).parent().siblings("td:eq(0)").text();
				class_array.push(data);
				th.push($(this));
			}
		});
		var uname = class_array + "";
		swal({
				title: "您确定要删除这条信息吗?",
				text: "删除后将无法恢复，请谨慎操作！",
				type: "warning",
				showCancelButton: true,
				confirmButtonColor: "#DD6B55",
				confirmButtonText: "删除",
				closeOnConfirm: false,
				closeOnCancel: false
			},
			function(isConfirm) {
				if(isConfirm) {
					$.ajax({
						url: "__URL__/delgroup",
						data: "uname=" + uname,
						type: "POST",
						success: function(data) {
							if(data == 1) {
								for(var i = 0; i < th.length; i++) {
									th[i].parent().parent().fadeOut("slow");
								}
								swal("删除成功！", "您已经永久删除了这条信息。", "success")
							} else {
								alert("未知错误,请联系管理员!!!");
							}
						}
					});
				} else {
					swal("已取消", "您取消了删除操作！", "error")
				}
			}
		);

	}
	//	根据浏览器宽度看是不是加滑动条
	if(document.body.clientWidth > 1000) {
		//用户管理查询数据
		$('#user').dataTable({
			"columnDefs": [{
				"targets": 0,
				"data": null,
				"defaultContent": "<input type='checkbox' class='check_user'/>"
			}, {
				"targets": -1,
				"data": null,
				"defaultContent": '<span title="修改"class="glyphicon glyphicon-pencil up_user" data-toggle="modal" data-target="#add_user"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span title="删除" class="glyphicon glyphicon-trash del_user"></span>'

			}],
			"ajax": "__URL__/select",
		});
	}else{
		//用户管理查询数据
		$('#user').dataTable({
			"columnDefs": [{
				"targets": 0,
				"data": null,
				"defaultContent": "<input type='checkbox' class='check_user'/>"
			}, {
				"targets": -1,
				"data": null,
				"defaultContent": '<span title="修改"class="glyphicon glyphicon-pencil up_user" data-toggle="modal" data-target="#add_user"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span title="删除" class="glyphicon glyphicon-trash del_user"></span>'

			}],
			"ajax": "__URL__/select",
			"scrollX": true,
		});
	}

	//用户管理修改图标点击事件
	$("tbody").delegate(".up_user", 'click', function() {
		$("#add_user").find(".modal-title").html("修改用户");
		$("#add").html("修改");
		th = $(this).parent();
		var names = ['uname', 'yx', 'zc', 'xl', 'phone'];
		for(var i = 0; i < 6; i++) {
			$(`input[name='${names[i]}']`).val(th.siblings(`td:eq(${i+1})`).text());
		}
	});
	//用户管理删除图表点击事件
	$("tbody").delegate(".del_user", 'click', function() {
		var th = $(this);
		var uname = th.parent().siblings("td:eq(1)").text();
		var url = "__URL__/delect?uname=" + uname;
		swal({
				title: "您确定要删除这条信息吗?",
				text: "删除后将无法恢复，请谨慎操作！",
				type: "warning",
				showCancelButton: true,
				confirmButtonColor: "#DD6B55",
				confirmButtonText: "删除",
				closeOnConfirm: false,
				closeOnCancel: false
			},
			function(isConfirm) {
				if(isConfirm) {
					$.ajax({
						url: url,
						type: "POST",
						success: function(data) {
							th.parent().parent().fadeOut("slow");
							swal("删除成功！", "您已经永久删除了这条信息。", "success")
						}
					});
				} else {
					swal("已取消", "您取消了删除操作！", "error")
				}
			}
		);
	});

	//添加用户按钮点击事件
	$("#add").on("click", function() {
		$(this).prev().click();
		var data = $('#add_u').serialize();
		var str = $("#add_user").find(".modal-title").html();
		var num = null;
		var title = '';
		if(str == "修改用户") {
			num = 2;
			title = "修改成功";
			data = data + "&num=" + num + "&uname=" + th.siblings(`td:eq(1)`).text();
		} else if(str == "添加用户") {
			num = 1;
			title = "添加成功";
			data = data + "&num=" + num;
		}
		$.ajax({
			url: "__URL__/add",
			data: data,
			type: "POST",
			success: function(data) {
				if(data == 1) {
					swal({
							title: title,
							text: "",
							type: "success",
							showCancelButton: false,
							confirmButtonColor: "#AEDEF4",
							confirmButtonText: "确定",
							closeOnConfirm: true,
							closeOnCancel: true
						},
						function(isConfirm) {
							if(isConfirm) {
								window.location = '__URL__';
							}
						}
					);
				}
			}
		});
	})
</script>

</body>

</html>