<include file="Public:header" />
<!-- 添加课程模态框（Modal） -->
<div class="modal fade" id="add_kc" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content animated flipInX">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
				<h4 class="modal-title">添加课程管理</h4>
			</div>
			<div class="modal-body" style="overflow: hidden">
				<div>
					<form class="form-horizontal" id="add">
						<div class="col-lg-6" style="border-right: 1px solid #ddd;padding-right:5em">
							<div class="form-group">
								<label class="col-sm-6 control-label">课程名：</label>

								<div class="col-sm-6">
									<input type="text" class="form-control" name="class_name" form="add" required>
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-6 control-label">课程类型：</label>

								<div class="col-sm-6">
									<input type="text" class="form-control" name="class_type" list="type" form="add">
									<datalist id="type">
                                        <option>必修课</option>
                                        <option>任选课</option>
                                        <option>其它</option>
                                    </datalist>
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-6 control-label">学时：</label>

								<div class="col-sm-6">
									<input type="number" min="0" class="form-control" name="xueshi" form="add">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-6 control-label">周数：</label>

								<div class="col-sm-6">
									<input type="number" min="0" class="form-control" name="zhou" form="add">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-6 control-label">班级：</label>

								<div class="col-sm-6">
									<input type="text" class="form-control" name="banji" form="add">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-6 control-label">额定人数：</label>

								<div class="col-sm-6">
									<input type="number" min="0" class="form-control" name="ed" form="add">
								</div>
							</div>
						</div>
						<div class="col-lg-6">

							<div class="form-group">
								<label class="col-sm-6 control-label">实际人数：</label>

								<div class="col-sm-6">
									<input type="number" min="0" class="form-control" name="shiji" form="add">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-6 control-label">重修：</label>

								<div class="col-sm-6">
									<input type="text" class="form-control" list="chongx" name="cx" form="add" required>
									<datalist id="chongx">
                                        <option>是</option>
                                        <option>否</option>
                                    </datalist>
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-6 control-label">核心课程：</label>

								<div class="col-sm-6">
									<input type="text" class="form-control" list="hexin" name="hx" form="add" required>
									<datalist id="hexin">
                                        <option>是</option>
                                        <option>否</option>
                                    </datalist>
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-6 control-label">优质课程：</label>

								<div class="col-sm-6">
									<input type="text" class="form-control" list="youzhi" name="yz" form="add" required>
									<datalist id="youzhi">
                                        <option>国家级</option>
                                        <option>省级</option>
                                        <option>校级</option>
                                    </datalist>
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-6 control-label">是否招人数少额定：</label>

								<div class="col-sm-6">
									<input type="text" class="form-control" list="y1" name="y1" form="add" required>
									<datalist id="y1">
                                        <option>是</option>
                                        <option>否</option>
                                    </datalist>
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-6 control-label">是否服从(额>实)：</label>

								<div class="col-sm-6">
									<input type="text" class="form-control" list="y2" name="y2" form="add" required>
									<datalist id="y2">
                                        <option>是</option>
                                        <option>否</option>
                                    </datalist>
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-6 control-label">教员：</label>

								<div class="col-sm-6">
									<input type="text" class="form-control" name="uname" form="add" required>
								</div>
							</div>

						</div>
						<br/>
					</form>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
				<button type="button" class="add_kecheng btn btn-primary">添加</button>
			</div>
		</div>
		<!-- /.modal-content -->
	</div>
	<!-- /.modal-dialog -->
</div>

<!--页面显示全部-->
<div id="wrapper">
	<include file="Public:left" />
	<!--右边显示部分-->
	<div id="page-wrapper" class="gray-bg dashbard-1">
		<include file="Public:top" />
		<!--课程管理-->
		<div id="course_control" class="right" style="display: block" ;>
			<div class="row wrapper border-bottom white-bg page-heading">
				<div class="col-lg-12">
					<h2>课程管理</h2>
					<ol class="breadcrumb">
						<li>
							<a href="index.html">主页</a>
						</li>
						<li>
							<a>课程管理</a>
							<li>
								<strong>课程管理</strong>
							</li>
					</ol>
				</div>
			</div>
			<div class="wrapper wrapper-content animated fadeInRight">
				<div class="row">
					<div class="col-lg-12">
						<div class="ibox float-e-margins">
							<div class="ibox-title">
								<h5>搜索结果</h5>

								<div class="ibox-tools">
									<a class="collapse-link">
										<i class="fa fa-chevron-up"></i>
									</a>
									<a class="dropdown-toggle" data-toggle="dropdown" href="table_data_tables.html#">
										<i class="fa fa-wrench"></i>
									</a>
									<ul class="dropdown-menu dropdown-user">
										<li>
											<a href="#">选项1</a>
										</li>
										<li>
											<a href="#">选项2</a>
										</li>
									</ul>
									<a class="close-link">
										<i class="fa fa-times"></i>
									</a>
								</div>
							</div>
							<div class="ibox-content">
								<div class="">
									<a onclick="dele_group(this);" href="javascript:void(0);" class="btn btn-danger"><span class="glyphicon glyphicon-trash"></span> 批量删除</a>&nbsp;
									<a onclick="del_add(this);" href="javascript:void(0);" class="btn btn-success " data-toggle="modal" data-target="#add_kc"><span class="glyphicon glyphicon-plus"></span> 添加课程</a>
								</div>
								<table id="kecheng" class="table table-striped table-bordered table-hover dataTables-example">
									<thead>
										<tr>
											<th class="text-center">
												<label><input type="checkbox" data-check="check_kecheng"/>全选</label>
											</th>
											<th class='text-center'>课程名</th>
											<th class='text-center'>课程类型</th>
											<th class='text-center'>学时</th>
											<th class='text-center'>周数</th>
											<th class='text-center'>班级</th>
											<th class='text-center'>额定人数</th>
											<th class='text-center'>实际人数</th>
											<th class='text-center'>重修</th>
											<th class='text-center'>核心课程</th>
											<th class='text-center'>优质课程</th>
											<th class='text-center'>是否招生人数少额定</th>
											<th class='text-center'>是否服从(额>实)</th>
											<th class='text-center'>教员</th>
											<th class='text-center'>状态</th>
											<th class='text-center' style="display:none">编号</th>
											<th class='text-center'>操作</th>

										</tr>
									</thead>
									<tbody>
										<!--<tr>
                                       
                                        <td class="text-center">
                                            <button class="btn btn-xs btn-primary">未核算</button>
                                        </td>
                                        <td class="text-center"><span title="编辑" id="edit"
                                                                      class="glyphicon glyphicon-pencil"
                                                                      data-toggle="modal" data-target="#edit_user">&nbsp;</span>
                                            <span data-toggle="modal" data-target="#alert_warning" title="删除"
                                                  class="glyphicon glyphicon-trash"></span></td>
                                    </tr>-->
									</tbody>
									<tfoot>
										<tr>
											<th class="text-center">全选</th>
											<th class='text-center'>课程名</th>
											<th class='text-center'>课程类型</th>
											<th class='text-center'>学时</th>
											<th class='text-center'>周数</th>
											<th class='text-center'>班级</th>
											<th class='text-center'>额定人数</th>
											<th class='text-center'>实际人数</th>
											<th class='text-center'>重修</th>
											<th class='text-center'>核心课程</th>
											<th class='text-center'>优质课程</th>
											<th class='text-center'>是否招生人数少额定</th>
											<th class='text-center'>是否服从(额>实)</th>
											<th class='text-center'>教员</th>
											<th class='text-center'>状态</th>
											<th class='text-center' style="display:none">编号</th>
											<th class='text-center'>操作</th>
										</tr>
									</tfoot>
								</table>

							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

	</div>
</div>
<include file="Public:bottom" />

<script>
	//选择课程中的倒数二行隐藏
	setTimeout(hide, 800);

	function hide() {
		$("#kecheng").find("tbody tr td:nth-child(16)").css("display", "none");
	}
	//	根据浏览器宽度看是不是加滑动条
	if(document.body.clientWidth > 1000) {
		//课程管理信息查询数据
		$('#kecheng').dataTable({
			"columnDefs": [{
				"targets": 0,
				"data": null,
				"defaultContent": "<input type='checkbox' class='check_kecheng'/>",
			}, {
				"targets": -1,
				"data": null,
				"defaultContent": '<span title="修改"class="glyphicon glyphicon-pencil up_kc" data-toggle="modal" data-target="#add_kc"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span data-toggle="modal" data-target="#alert_warning" title = "删除" class = "del_kc glyphicon glyphicon-trash"> </span >',
			}],
			"ajax": "__URL__/do_data",
		});
	}else{
		//课程管理信息查询数据
		$('#kecheng').dataTable({
			"columnDefs": [{
				"targets": 0,
				"data": null,
				"defaultContent": "<input type='checkbox' class='check_kecheng'/>",
			}, {
				"targets": -1,
				"data": null,
				"defaultContent": '<span title="修改"class="glyphicon glyphicon-pencil up_kc" data-toggle="modal" data-target="#add_kc"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span data-toggle="modal" data-target="#alert_warning" title = "删除" class = "del_kc glyphicon glyphicon-trash"> </span >',
			}],
			"ajax": "__URL__/do_data",
			"scrollX": true,
		});
	}

	//课程管理删除图表点击事件
	$("tbody").delegate(".del_kc", 'click', function() {
		var th = $(this);
		var id = th.parent().siblings("td:eq(15)").text();
		var url = "__URL__/delect?id=" + id;
		swal({
				title: "您确定要删除这条信息吗?",
				text: "删除后将无法恢复，请谨慎操作！",
				type: "warning",
				showCancelButton: true,
				confirmButtonColor: "#DD6B55",
				confirmButtonText: "删除",
				closeOnConfirm: false,
				closeOnCancel: false
			},
			function(isConfirm) {
				if(isConfirm) {
					$.ajax({
						url: url,
						type: "POST",
						success: function(data) {
							if(data == 1) {
								th.parent().parent().fadeOut("slow");
								swal("删除成功！", "您已经永久删除了这条信息。", "success")
							}
						}
					});
				} else {
					swal("已取消", "您取消了删除操作！", "error")
				}
			}
		);
	});

	//理论教学添加课程按钮点击
	function del_add(t) {
		if($(t).html().indexOf("修改课程管理")) {
			$("#add_class").find(".modal-title").html("添加课程管理");
			$(".add_kecheng").html("添加");
		}
		var names = ['class_name', 'class_type', 'xueshi', 'zhou', 'banji', 'ed', 'shiji', 'cx', 'hx', 'yz', 'y1', 'y2', 'uname'];
		for(var i = 0; i < 13; i++) {
			//console.log(""+$(`input[name='${names[i]}']`));
			$(`input[name='${names[i]}']`).val("");
		}
	}

	//课程管理修改图标点击事件
	$("tbody").delegate(".up_kc", 'click', function() {
		$("#add_kc").find(".modal-title").html("修改课程管理");
		$(".add_kecheng").html("修改");
		th = $(this).parent();
		var names = ['class_name', 'class_type', 'xueshi', 'zhou', 'banji', 'ed', 'shiji', 'cx', 'hx', 'yz', 'y1', 'y2', 'uname'];
		for(var i = 0; i < 13; i++) {
			$(`input[name='${names[i]}']`).val(th.siblings(`td:eq(${i+1})`).text());
		}
	});

	//添加课程管理按钮点击事件
	$(".add_kecheng").on("click", function() {
		$(this).prev().click();
		var data = $('#add').serialize();
		var str = $("#add_kc").find(".modal-title").html();
		var title = '';
		var url = '';
		if(str == "修改课程管理") {
			url = "__URL__/update";
			title = "修改成功";
			data = data + '&id=' + th.siblings(`td:eq(15)`).text();
		} else if(str == "添加课程管理") {
			url = "__URL__/add";
			title = "添加成功";
			data = data;
		}
		$.ajax({
			url: url,
			data: data,
			type: "POST",
			success: function(data) {
				if(data == 1) {
					swal({
							title: title,
							text: "",
							type: "success",
							showCancelButton: false,
							confirmButtonColor: "#AEDEF4",
							confirmButtonText: "确定",
							closeOnConfirm: true,
							closeOnCancel: true
						},
						function(isConfirm) {
							if(isConfirm) {
								window.location = '__URL__';
							}
						}
					);
				}
			}
		});
	})

	//删除用户
	function dele_group(self) {
		var class_array = [];
		var th = [];
		$("input[class='check_kecheng']").prop("checked", function(i, val) {
			if(val) {
				var data = $(this).parent().siblings("td:eq(14)").text();
				console.log(data);
				class_array.push(data);
				th.push($(this));
			}
		});
		var id = class_array + "";
		swal({
				title: "您确定要删除这条信息吗?",
				text: "删除后将无法恢复，请谨慎操作！",
				type: "warning",
				showCancelButton: true,
				confirmButtonColor: "#DD6B55",
				confirmButtonText: "删除",
				closeOnConfirm: false,
				closeOnCancel: false
			},
			function(isConfirm) {
				if(isConfirm) {
					$.ajax({
						url: "__URL__/delgroup",
						data: "id=" + id,
						type: "POST",
						success: function(data) {
							if(data == 1) {
								for(var i = 0; i < th.length; i++) {
									th[i].parent().parent().fadeOut("slow");
								}
								swal("删除成功！", "您已经永久删除了这条信息。", "success")
							} else {
								alert("未知错误,请联系管理员!!!");
							}
						}
					});
				} else {
					swal("已取消", "您取消了删除操作！", "error")
				}
			}
		);

	}
</script>

</body>

</html>