<include file="Public:header" />
<!-- 添加课程模态框（Modal） -->
<div class="modal fade" id="add_class" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content animated flipInX">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
				<h4 class="modal-title">添加课程</h4>
			</div>
			<div class="modal-body" style="overflow: hidden">
				<div>
					<form class="form-horizontal" id="add">
						<div class="col-lg-6" style="border-right: 1px solid #ddd;padding-right:5em">
							<div class="form-group">
								<label class="col-sm-6 control-label">课程名：</label>

								<div class="col-sm-6">
									<input type="text" class="form-control" name="class_name" form="add" required>
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-6 control-label">课程类型：</label>

								<div class="col-sm-6">
									<input type="text" class="form-control" name="class_type" list="type" form="add">
									<datalist id="type">
                                        <option>必修课</option>
                                        <option>任选课</option>
                                        <option>其它</option>
                                    </datalist>
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-6 control-label">实验学时：</label>

								<div class="col-sm-6">
									<input type="number" min="0" class="form-control" name="score" form="add">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-6 control-label">总学时：</label>

								<div class="col-sm-6">
									<input type="number" min="0" class="form-control" name="study_time" form="add">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-6 control-label">学生人数：</label>

								<div class="col-sm-6">
									<input type="number" min="0" class="form-control" name="stu_num" form="add">
								</div>
							</div>
						</div>
						<div class="col-lg-6">
							<div class="form-group">
								<label class="col-sm-6 control-label">专业：</label>

								<div class="col-sm-6">
									<input type="text" class="form-control" name="zhuanye" form="add">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-6 control-label">实验类型：</label>

								<div class="col-sm-6">
									<input type="text" class="form-control" list="sylx" name="nianji" form="add" required>
									<datalist id="sylx">
                                        <option>无</option>
                                        <option>基础性实验</option>
                                        <option>上机实验</option>
                                        <option>一般性实验</option>
                                        <option>专业类实验</option>
                                    </datalist>
								</div>
							</div>
							<br/>
							<div class="form-group">
								<label class="col-sm-6 control-label">班级：</label>

								<div class="col-sm-6">
									<input type="text" class="form-control" name="banji" form="add">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-6 control-label">考核方式：</label>

								<div class="col-sm-6">
									<input type="text" class="form-control" list="kaoshi" name="kaishi" form="add">
									<datalist id="kaoshi">
                                        <option>考查</option>
                                        <option>考试</option>
                                    </datalist>
								</div>
							</div>

						</div>
						<br/>
					</form>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal" id='close'>关闭</button>
				<button type="button" class="add_class btn btn-primary">添加</button>
			</div>
		</div>
		<!-- /.modal-content -->
	</div>
	<!-- /.modal-dialog -->
</div>
<!--页面显示全部-->
<div id="wrapper">
	<!-- 左边导航部分/.modal -->
	<include file="Public:left" />
	<!--右边显示部分-->
	<div id="page-wrapper" class="gray-bg dashbard-1">
		<include file="Public:top" />
		<!--理论教学信息-->
		<div id="teach_info_pass" class="right" style="display: block;">
			<div class="row wrapper border-bottom white-bg page-heading">
				<div class="col-lg-10">
					<h2>理论教学信息</h2>
					<ol class="breadcrumb">
						<li>
							<a href="index.html">主页</a>
						</li>
						<li>
							<strong>理论教学信息</strong>
						</li>
					</ol>
				</div>
				<div class="col-lg-2">

				</div>
			</div>
			<div class="wrapper wrapper-content animated fadeInRight">
				<div class="row">
					<div class="col-lg-12">
						<div class="ibox float-e-margins">
							<div class="ibox-title">
								<h5>理论</h5>

								<div class="ibox-tools">
									<a class="collapse-link">
										<i class="fa fa-chevron-up"></i>
									</a>
									<a class="dropdown-toggle" data-toggle="dropdown" href="table_data_tables.html#">
										<i class="fa fa-wrench"></i>
									</a>
									<ul class="dropdown-menu dropdown-user">
										<li>
											<a href="#">选项1</a>
										</li>
										<li>
											<a href="#">选项2</a>
										</li>
									</ul>
									<a class="close-link">
										<i class="fa fa-times"></i>
									</a>
								</div>
							</div>
							<div class="ibox-content">
								<div>
									<a onclick="update(this);" href="javascript:void(0);" class="btn btn-success " data-toggle="modal" data-target="#add_class"><span class="glyphicon glyphicon-plus"></span>添加课程</a>&nbsp;&nbsp;
									<p style="font-size: 20px;vertical-align: middle" class=" glyphicon glyphicon-hand-left"></p>&nbsp;课程遗漏
								</div>
								<div class="">
									<table id="table_teach_info_pass" class="table table-striped table-bordered table-hover">
										<thead>
											<tr>
												<th class='text-center'>课程名</th>
												<th class='text-center'>专业</th>
												<th class='text-center'>课程类型</th>
												<th class='text-center'>班级</th>
												<th class='text-center'>考核方式</th>
												<th class='text-center'>学生人数</th>
												<th class='text-center'>总学时</th>
												<th class='text-center'>实验学时</th>
												<th class='text-center'>实验类型</th>
												<th class='text-center'>状态</th>
												<th class='text-center' style="display:none;">编码</th>
												<th class='text-center'>操作</th>
											</tr>
										</thead>
										<tbody>
										</tbody>
										<tfoot>
											<tr>
												<th class='text-center'>课程名</th>
												<th class='text-center'>专业</th>
												<th class='text-center'>课程类型</th>
												<th class='text-center'>班级</th>
												<th class='text-center'>考核方式</th>
												<th class='text-center'>学生人数</th>
												<th class='text-center'>总学时</th>
												<th class='text-center'>实验学时</th>
												<th class='text-center'>实验类型</th>
												<th class='text-center'>状态</th>
												<th class='text-center' style="display:none;">编码</th>
												<th class='text-center'>操作</th>
											</tr>
										</tfoot>
									</table>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<include file="Public:bottom" />

<script>
	//选择理论表格中的倒数二行隐藏
	setTimeout(hide, 1000);

	function hide() {
		$("#teach_info_pass").find("tbody tr td:nth-child(11)").css("display", "none");
	}
	//理论教学删除图标点击事件
	$("tbody").delegate(".del_lilun", 'click', function() {
		var th = $(this);
		var id = th.parent().siblings("td:eq(10)").text();

		var url = "__URL__/delect?id=" + id;
		swal({
				title: "您确定要删除这条信息吗?",
				text: "删除后将无法恢复，请谨慎操作！",
				type: "warning",
				showCancelButton: true,
				confirmButtonColor: "#DD6B55",
				confirmButtonText: "删除",
				closeOnConfirm: false,
				closeOnCancel: false
			},
			function(isConfirm) {
				if(isConfirm) {
					$.ajax({
						url: url,
						type: "POST",
						success: function(data) {
							if(data == 1) {
								th.parent().parent().fadeOut("slow");
								swal("删除成功！", "您已经永久删除了这条信息。", "success")
							}
						}
					});
				} else {
					swal("已取消", "您取消了删除操作！", "error")
				}
			}
		);
	});
	//理论教学修改图标点击事件
	$("tbody").delegate(".update", 'click', function() {
		$("#add_class").find(".modal-title").html("修改课程");
		$(".add_class").html("修改");
		th = $(this).parent();
		var names = ['class_name', 'zhuanye', 'class_type', 'banji', 'kaishi', 'stu_num', 'study_time', 'score', 'nianji'];
		for(var i = 0; i < 9; i++) {
			$(`input[name='${names[i]}']`).val(th.siblings(`td:eq(${i})`).text());
		}
	});
	//判断修改和删除按钮能不能点击
	var time = setInterval(panduan, 500);

	function panduan() {
		function inner(c1, c2, c3) {
			$(`#${c1}`).find(`tbody tr td:nth-child(${c2})`).each(function(indx, val) {
				if($(this).html() == "已加入核算") {
					$(this).next().css("cursor", "not-allowed");
					$(this).next().next().children().css({
						"cursor": "not-allowed",
						"color": "#ccc"
					}).removeAttr("data-target").removeClass(`${c3}`);
				}
			});
		}
		inner("table_teach_info_pass", 10, "del_lilun");
		if(time > 5) {
			clearInterval(time);
		}
	}
	//添加课程确定按钮点击事件
	$(".add_class").on("click", function() {
		$(this).prev().click();
		var data = $('#add').serialize();
		var str = $("#add_class").find(".modal-title").html();
		var title = '';
		var url = '';
		if(str == "修改课程") {
			url = "__URL__/update";
			title = "修改成功";
			data = data + '&id=' + th.siblings(`td:eq(10)`).text();
		} else if(str == "添加课程") {
			url = "__URL__/add";
			title = "添加成功";
			data = data + "&uname=" + localStorage.u_name;
		}
		$.ajax({
			url: url,
			data: data,
			type: "POST",
			success: function(data) {
				if(data == 1) {
					swal({
							title: title,
							text: "已提交,等待管理员审核!!!",
							type: "success",
							showCancelButton: false,
							confirmButtonColor: "#AEDEF4",
							confirmButtonText: "确定",
							closeOnConfirm: true,
							closeOnCancel: true
						},
						function(isConfirm) {
							if(isConfirm) {
								window.location = '__URL__';
							}
						}
					);

				}
			}
		});
	})
//	判断浏览器的宽度
	if(document.body.clientWidth > 1000) {
		//理论教学数据信息加载
		$('#table_teach_info_pass').dataTable({
			"columnDefs": [{
				"targets": -1,
				"data": null,
				"defaultContent": '<span title="修改"class="glyphicon glyphicon-pencil update" data-toggle="modal" data-target="#add_class">&nbsp;</span> <span title="删除" class="glyphicon glyphicon-trash del_lilun"></span>'
			}],
			"ajax": "__URL__/do_data?name=" + localStorage.u_name,
		});
	}else{
		//理论教学数据信息加载
		$('#table_teach_info_pass').dataTable({
			"columnDefs": [{
				"targets": -1,
				"data": null,
				"defaultContent": '<span title="修改"class="glyphicon glyphicon-pencil update" data-toggle="modal" data-target="#add_class">&nbsp;</span> <span title="删除" class="glyphicon glyphicon-trash del_lilun"></span>'
			}],

			"ajax": "__URL__/do_data?name=" + localStorage.u_name,
			"scrollX": true,
		});
	}

	//理论教学添加课程按钮点击
	function update(t) {
		console.log($(t).html());
		if($(t).html().indexOf("修改课程")) {
			$("#add_class").find(".modal-title").html("添加课程");
			$(".add_class").html("添加");
		}
		var names = ['class_name', 'score', 'nianji', 'zhuanye', 'class_type', 'banji', 'kaishi', 'stu_num', 'study_time'];
		for(var i = 0; i < 9; i++) {
			//console.log(""+$(`input[name='${names[i]}']`));
			$(`input[name='${names[i]}']`).val("");
		}
	}
	$(document).ready(function() {
		$(".i-checks").iCheck({
			checkboxClass: "icheckbox_square-green",
			radioClass: "iradio_square-green",
		});
		$(".summernote").summernote({
			lang: "zh-CN"
		})
	});
	var edit = function() {
		$(".click2edit").summernote({
			focus: true
		})
	};
	var save = function() {
		var aHTML = $(".click2edit").code();
		$(".click2edit").destroy()
	};
</script>

</body>

</html>